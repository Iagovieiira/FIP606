{
  "hash": "e04785bf5c8d620ccdfe440c33e6c7f1",
  "result": {
    "markdown": "---\ntitle: \"Importação, visualização e criação de subconjuntos\"\nformat: html\neditor: visual\neditor_options: \nchunk_output_type: inline\nwarning: false\nmessage: false \n---\n\n\nDurante a aula 3, serão apresentadas ferramentas para se realizar uma análise descritiva do conjunto de dados. Além disso, o pacote **`tidyverse`** será utilizado para manipulação, criação de subconjuntos e organização dos dados.\n\n## **Importando dados**\n\nPara importação de um conjunto de dados .csv na web.os dados utlizados serão importados de um arquivo .csv disponível em nuvem. Entretanto, o arquivo traz valores de incidência e severidade da ferrugem do cafeeiro em diferentes regiões da Etiópia, de acordo com o sistema de cultivo, manejo da fazenda, sombreamento, cultivar...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ncr <- read_csv(\"https://raw.githubusercontent.com/emdelponte/paper-coffee-rust-Ethiopia/master/data/survey_clean.csv\")\n\n  \n# Mostrar as variaveis dos dados importados \nglimpse(cr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 405\nColumns: 13\n$ farm            <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…\n$ region          <chr> \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", …\n$ zone            <chr> \"Bench Maji\", \"Bench Maji\", \"Bench Maji\", \"Bench Maji\"…\n$ district        <chr> \"Debub Bench\", \"Debub Bench\", \"Debub Bench\", \"Debub Be…\n$ lon             <dbl> 35.44250, 35.44250, 35.42861, 35.42861, 35.42861, 35.3…\n$ lat             <dbl> 6.904722, 6.904722, 6.904444, 6.904444, 6.904444, 6.90…\n$ altitude        <dbl> 1100, 1342, 1434, 1100, 1400, 1342, 1432, 1100, 1400, …\n$ cultivar        <chr> \"Local\", \"Mixture\", \"Mixture\", \"Local\", \"Local\", \"Mixt…\n$ shade           <chr> \"Sun\", \"Mid shade\", \"Mid shade\", \"Sun\", \"Sun\", \"Mid sh…\n$ cropping_system <chr> \"Plantation\", \"Plantation\", \"Plantation\", \"Plantation\"…\n$ farm_management <chr> \"Unmanaged\", \"Minimal\", \"Minimal\", \"Unmanaged\", \"Unman…\n$ inc             <dbl> 86.70805, 51.34354, 43.20000, 76.70805, 47.15808, 51.3…\n$ sev2            <dbl> 55.57986, 17.90349, 8.25120, 46.10154, 12.25167, 19.91…\n```\n:::\n\n```{.r .cell-code}\n# Distribuição da doença (severidade: quanto de doença tenho em cada folha) e incidencia: Proporção de ausencia e presença da doença seja em folhas ou em plantas\n\n\n\n## como esta destribuida a incidencia da doença nas fazendas (criar um histograma)\n\ncr |> \n  \n  ggplot(aes(x = inc))+\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsummary(cr$inc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   9.50   19.43   32.50   34.89   48.20   86.71 \n```\n:::\n\n```{.r .cell-code}\n# Neste caso é multimodal (vairios picos nesse caso antes de 50%)\n#No histograma gerado, é possível notar que os valores de incidência apresentam três picos (ou seja, são valores de incidência com maior frequência). Além disso, a incidência aparenta não seguir distribuição normal, uma vez que o histograma apresenta um deslocamento à esquerda.\n```\n:::\n\n\n## Sumarização dos dados\n\nusando as funções \"group_bay\" e \"summary\":\n\n\n::: {.cell}\n\n```{.r .cell-code}\n summary(cr$inc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   9.50   19.43   32.50   34.89   48.20   86.71 \n```\n:::\n\n```{.r .cell-code}\n #mediana é o valor central \n```\n:::\n\n\n## Sumarização dos dados\n\n-   É possível criar histogramas por algum critério, por exemplo, as regiões. Para isso, será utilizada a função **`facet_wrap`** e a função `summarize` que serve para resumir ou agregar dados, calculando estatísticas como médias, medianas, desvios padrão, contagens, entre outros, com base em grupos definidos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Agrupamento por região\ncr |> \n  ggplot(aes(x = inc))+\n  geom_boxplot()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#MÉDIA: A média é uma medida de tendência central que representa o valor típico de um conjunto de dados. \n\ncr |> \ngroup_by(region) |> \n  summarize(inc_mean = mean(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  region inc_mean\n  <chr>     <dbl>\n1 Oromia     37.0\n2 SNNPR      33.4\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Média, mediana, cultivar da região \ncr |> \ngroup_by(region) |> \n  summarise(inc_med= median (inc), inc_mean = mean(inc), sd_mean = sd(inc)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  region inc_med inc_mean sd_mean\n  <chr>    <dbl>    <dbl>   <dbl>\n1 Oromia    39.5     37.0    14.6\n2 SNNPR     29.6     33.4    18.9\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes (inc, sev2))+\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#No gráfico gerado é possível observar que há alta correlação positiva entre as variáveis severidade e incidência.\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(x = inc))+\n  geom_histogram()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# neste caso a mediana e média são mais distantes \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  summarise(sev_med= median (sev2),\n            sev_mean = mean(sev2),\n            sd_mean = sd(sev2)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n  sev_med sev_mean sd_mean\n    <dbl>    <dbl>   <dbl>\n1    5.95     9.09    9.22\n```\n:::\n\n```{.r .cell-code}\n# o que prova que a mediana e a média são mais distates \n```\n:::\n\n\n### **Análise da severidade**\n\n-   Serão realizadas análises de severidade em função da região e da cultivar. Será utilizada a função `group_by.`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# por cultivar \ncr |> \ngroup_by(cultivar) |> \n  summarise(sev_med= median (sev2),\n            sev_mean = mean(sev2),\n            sd_mean = sd(sev2)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  cultivar sev_med sev_mean sd_mean\n  <chr>      <dbl>    <dbl>   <dbl>\n1 Improved    1.64     2.16    1.82\n2 Local      17.2     18.7    11.1 \n3 Mixture     5.43     6.47    4.35\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \ngroup_by(cultivar) |> \n  summarise(sev_med= median (sev2),\n            sev_mean = mean(sev2),\n            sd_mean = sd(sev2)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  cultivar sev_med sev_mean sd_mean\n  <chr>      <dbl>    <dbl>   <dbl>\n1 Improved    1.64     2.16    1.82\n2 Local      17.2     18.7    11.1 \n3 Mixture     5.43     6.47    4.35\n```\n:::\n:::\n\n\n#### **Severidade por região e cultivar**\n\nAgora, será gerado um histograma da severidade em função de duas variáveis independentes, a região e a cultivar. Nesse caso, será utlilizada a função `facet_grid`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(x = sev2, fill = region))+\n  geom_histogram()+\n  facet_grid(region ~ cultivar)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### **Visualizando os dados do conjunto**\n\nO pacote `ggthemes` no R é uma extensão do `ggplot2` que oferece uma ampla variedade de temas e estilos para personalizar gráficos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggthemes)\ncr |> \n  ggplot(aes(x = sev2, fill = region))+\n  geom_histogram()+\n  facet_grid(region ~ cultivar)+\n  scale_fill_colorblind()\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(x = sev2, fill = region))+\n  geom_histogram(color = \"black\")+\n  facet_grid(region ~ cultivar)+\n  scale_fill_manual(values = c(\"white\", \"blue\"))+\n  theme_minimal(base_size = 12)+\n  theme(legend.position = \"bottom\")+\n  labs(y = \"frequency\",\n       x = \"severity (%)\", fill = \"region\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#É possível notar que com a função facet_grid, o plot se torna mais harmônico.\n```\n:::\n\n\n## **Criando subconjuntos**\n\nPara criação de subconjuntos, serão utilizadas duas funções: `select` e `filter` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtra Oromia\n\ncr_oromia <- cr |> \n  select (farm, region, cultivar, sev2) |> \n  filter(region == \"Oromia\")\n\ncr_oromia\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 165 × 4\n    farm region cultivar  sev2\n   <dbl> <chr>  <chr>    <dbl>\n 1   286 Oromia Mixture   7.63\n 2   287 Oromia Mixture   9.39\n 3   288 Oromia Mixture   1.30\n 4   289 Oromia Mixture   9.79\n 5   290 Oromia Local    18.5 \n 6   291 Oromia Mixture  13.2 \n 7   292 Oromia Mixture   5.60\n 8   293 Oromia Mixture   1.06\n 9   294 Oromia Local    17.6 \n10   295 Oromia Mixture  15.4 \n# ℹ 155 more rows\n```\n:::\n\n```{.r .cell-code}\n# filtra SNNPR\ncr_pr <- cr |> \n  select (farm, region, cultivar, sev2) |> \n  filter(region == \"SNNPR\")\n\ncr_pr\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 240 × 4\n    farm region cultivar  sev2\n   <dbl> <chr>  <chr>    <dbl>\n 1     1 SNNPR  Local    55.6 \n 2     2 SNNPR  Mixture  17.9 \n 3     3 SNNPR  Mixture   8.25\n 4     4 SNNPR  Local    46.1 \n 5     5 SNNPR  Local    12.3 \n 6     6 SNNPR  Mixture  19.9 \n 7     7 SNNPR  Mixture  11.9 \n 8     8 SNNPR  Local    55.6 \n 9     9 SNNPR  Local    11.6 \n10    10 SNNPR  Mixture  11.4 \n# ℹ 230 more rows\n```\n:::\n:::\n\n\n### **Visualizando os subconjuntos graficamente:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- cr_oromia |> \n  ggplot(aes(cultivar,sev2, fill = cultivar))+ \n  geom_boxplot()+\n  labs(x = \"\", y= \"Severity (%)\") +\n  coord_flip()\n\n\np2 <- cr_pr |>  \n  ggplot(aes(cultivar,sev2, fill = cultivar))+ \n  geom_boxplot()+\n  labs(x= \"\", y= \"Severity(%)\") +\ncoord_flip()\n\n#Também é possível inverter o modo como o boxplot é plotado, utilizando a função coord_flip\n```\n:::\n\n\n### Para juntar gráficos em diferentes posicionamentos:\n\nUtliza-se o pacote `patchwork` uma ferramenta robusta para unir múltiplos gráficos gerados com `ggplot2` em uma única disposição. Ele simplifica a elaboração de layouts complexos e personalizados, possibilitando a combinação de gráficos lado a lado, sobrepostos ou em matrizes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\n# Ao lado\np1 + p2\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Acima \np1 / p2\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Retirar a legenda duplicada\n(p1 + p2) +\n  plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Atribuir letras a cada gráfico\n(p1 / p2) +\n  plot_layout(guides = \"collect\", axes= \"collect\") +\n  plot_annotation(title = \"Coffe rust Ethiopia\", \n                  caption = \"source: vieira (2022)\",\n    tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-16-4.png){width=672}\n:::\n\n```{.r .cell-code}\np3 <- cr_oromia |> \n  ggplot(aes(x = sev2))+\n  geom_histogram()\n\np1 + inset_element(p3, left = 0.6, bottom = 0.6, right = 1, top = 1)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-16-5.png){width=672}\n:::\n:::\n\n\nPara o salvar o gráfico criado:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"patch1.png\", width = 5, height = 4)\n```\n:::\n",
    "supporting": [
      "Aula3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}