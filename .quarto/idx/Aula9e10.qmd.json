{"title":"Experimento fatorial e ajuste de modelos - Análise de correlação","markdown":{"yaml":{"title":"Experimento fatorial e ajuste de modelos - Análise de correlação","format":"html","editor":"visual","message":false,"warning":false},"headingText":"Pacotes carregados","containsRefs":false,"markdown":"\n\nDurante a aula 9, vão ser estudados dados que levam a entender melhor os Experimento fatorial e ajuste de modelos\n\n\n```{r}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(r4pde)\nlibrary(drc)\nlibrary(stats)\n```\n\n## **Importando dados**\n\n```{r}\nmilho <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759\")\n```\n\n## **Análise de um experimento em parcelas subdivididas**\n\nExperimentos em parcelas subdivididas são utilizados quando o nível de um fator primário (ou tratamento) é aplicado a uma parcela relativamente grande e todos os níveis de um segundo fator secundário são aplicados às subparcelas desta parcela maior. Os tratamentos primários são distribuídos às parcelas de acordo com um delineamento especificado, já os tratamentos secundários são distribuídos às subparcelas de forma aleatória.\n\n## **visualização dos dados**\n\n```{r}\nmilho |> \n  ggplot(aes(method,index))+\n  geom_jitter(which = 0.1, alpha = 0.2)+\n  facet_wrap(~ hybrid)+\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"blue\")\n\n##Dependendo do híbrido parece que há efeito do método\n\n```\n\n## **Modelo para parcela subdividida**\n\n```{r}\nmilho <- milho |> \n  mutate(block = as.factor(block))\n\nmix2 <- lmer(index ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n\n\n#No fator aleatório, colocamos o hibrido dentro do bloco. ( 1 | block/hybrid); Comparamos os híbridos nas linhas e os métodos nas colunas.\n\n```\n\nANOVA MIX2\n\n```{r}\nanova (mix2)\n```\n\n#### **Verificação das premissas**\n\n```{r}\ncheck_normality(mix2)\ncheck_heteroscedasticity(mix2)\n```\n\n```{r}\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\n```\n\nConclui-se que os dados seguem distribuição normal. Porém, não há homogeneidade de variância entre os grupos. Logo será preciso uma alternativa para prosseguir a análise, por exemplo a transformação dos dados com raiz quadrada.\n\nDepois de carregar o Emmeans:\n\n```{r}\nmedias_milho <- emmeans(mix2,\n                        ~ hybrid | method,\n                        type = \"response\")\nmedias_milho\nmedias_milho2 <- emmeans(mix2,\n                         ~ method | hybrid,\n                         type = \"response\")\nmedias_milho2\n```\n\n```{r}\ncld(medias_milho2, Letters = LETTERS)\n```\n\nA significância da anova ou efeitos da interação; Realiza-se o teste de médias se há efeito; Comparamos a diferença dentro dos métodos, e depois, comparamos a diferença entre os métodos dentro dos híbridos.\n\n## **Produtividade (yield)**\n\nSeguindo os mesmos procedimentos para o índice de doença, será conduzida avaliação da produtividade.\n\n```{r}\nmix3 <- lmer(sqrt(index) ~ hybrid*method + block + (1|block/hybrid), data = milho)\n```\n\n**ANOVA MIX3**\n\n```{r}\nanova (mix3)\n```\n\n#### **Verificação das premissas**\n\n```{r}\ncheck_normality(mix3)\ncheck_heteroscedasticity(mix3)\n\n```\n\n# **Regressão linear**\n\nUsada para modelar e analisar a relação entre uma variável dependente (também chamada de variável resposta) e uma ou mais variáveis independentes (também chamadas de variáveis preditoras). O objetivo da regressão linear é ajustar uma linha reta (ou um plano, no caso de múltiplas variáveis) aos dados que minimiza a soma dos quadrados dos resíduos (a diferença entre os valores observados e os valores previstos pelo modelo).\n\n## **Importando dados**\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n## **visualização dos dados**\n\n```{r}\n   estande |> \n  ggplot(aes(trat, nplants))+\n  geom_jitter(which = 0.1, alpha = 0.3)+\n  facet_wrap(~ exp)+\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"black\")+\n     geom_smooth(method = \"lm\", se = F)\n\n   \n   #Mostramos biologicamente que há redução do estande de plantas conforme o aumento da inoculação do patógeno. podemos assumir dois modelos: linear simples ou quadrático. Podemos verificar qual modelo se adequa melhor à regressão.\n```\n\nExperimento 1:\n\n```{r}\nexp1 <- estande |> \n  filter(exp == 1)\n\nexp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F)\n```\n\n```{r}\n#MODELO LINEAR\n\nlm1 = lm(nplants ~ trat,\n         data = exp1)\n\nsummary (lm1)\n```\n\nExperimento 2:\n\n```{r}\nexp2 <- estande |> \n  filter(exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F, method = \"lm\",\n              formula = y~poly(x,2),\n              color = \"red\")+\n  geom_smooth(method = \"lm\", se = FALSE)\n\n\n```\n\n```{r}\n\n#Modelo de primeira ordem\nlm2 <- lm(nplants~trat,\n          data = exp2)\n\nsummary(lm2)\nhist(residuals(lm2))\n\n# Nodelo de segunda ordem\nexp2$trat2 <- exp2$trat^2\n\n```\n\nExperimento 3:\n\n```{r}\nexp3 <- estande |> \n  filter(exp == 3)\n\nexp3 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F) #method = \"lm\")\n```\n\n```{r}\nlm3 <- lm(nplants~trat + trat2,\n          data = exp2)\n\nsummary(lm3)\nhist(residuals(lm3))\n```\n\nComparação de modelos diferente usando os mesmos dados\n\n### **Usando GLM**\n\nPodemos atribuir o glm com distribuição normal ou distribuição de poisson (considerando que a distribuição não é normal).\n\n```{r}\n#glm2 <- glm(nplants ~ trat, family = gaussian, data = exp2)\n#summary(glm2)\n\n#AIC(glm2)\n\nglm2b <- glm(nplants ~ trat, family = \"poisson\", data  = exp2)\nsummary(glm2b)\n```\n\n```{r}\nglm2b <- glm(nplants ~ trat, family = poisson(link = \"log\"),\n             data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n```\n\n## **Análise de múltiplos ensaios**\n\nCom múltiplos ensaios, é possível analisá-los individualmente para observar uma tendência geral no comportamento dos tratamentos. No entanto, existem outras alternativas, como aplicar um modelo de regressão linear global ou extrair a informação global utilizando modelos mistos. Nesse caso, os ensaios são tratados como fator aleatório, ou seja, advêm de uma distribuição (população), e o objetivo é estimar os parâmetros para essa população. Para exemplificar esse caso, um conjunto de dados (`WhiteMoldSoybean`) presente no pacote **`r4pde`** será importado, mas antes o pacote deverá ser carregado. AIC menor é o melhor modelo ajustado.\n\n```{r}\nwm <- WhiteMoldSoybean\n\n\nwm |> \n  ggplot(aes(inc, yld))+\n  geom_point()+\n  facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\n#Predizer uma resposta em relação à outra. Duas respostas numéricas contínuas, ajustanto o modelo linear ou não. Muitos estudos diferentes, gráfico geral. A saída dos gráficos mostra que com a ação do fungicida e redução da severidade acontece um incremento de produtividade da soja.\n```\n\n```{r}\nmofo1 <- lm(yld ~ inc,\n            data = wm)\n#intercepto pordutividade quando a incidencia é zero, inc é o slope com 10% de incidencia esta perdendo 90kg. \nsummary(mofo1)\n\n#O 3299 é a produtividade por ha quando não há controle. O 9,261 indica a redução de produtividade em kg/ha de acordo com o aumento da severidade.\n```\n\n### **Modelo linear por ensaio**\n\nAgrupando todos os estudos em um único gráfico.\n\n#### **Mofo 1**\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld, group = factor(study)))+\n  geom_point()+\n  #facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\nmofo1 <- lm(yld ~ inc,\n            data = wm)\nsummary(mofo1)\n\n#Código muito importante para agrupar vários experimentos. Já detalha as médias para cada variável resposta.\n```\n\n#### **Mofo 2**\n\n```{r}\nlibrary(broom)\nmofo2 <- wm |> \n  group_by(study) |> \n  do(tidy(lm(.$yld ~ .$inc), conf.int = TRUE))\nmofo2\n```\n\n```{r}\ndf<- mofo2 |> \n  filter(term == \".$inc\")\nmean(df$estimate)\n```\n\n```{r}\n#Histograma da produtividade quando incidência é 0\nlibrary(cowplot)\np1 <- mofo2 |> \n  filter(term == \"(Intercept)\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Intercept\", y = \"frequency\")\np2 <- mofo2 |> \n  filter(term == \".$inc\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Slopes\", y = \"frequency\")\nlibrary(patchwork)\np1+p2\n\n\n```\n\n**Mofo 3**\n\n**Modelo misto**\n\n```{r}\n#Modelo misto\nmofo3 <- lmer(yld ~ inc + (inc | study), data = wm,\n              REML = F)\nsummary(mofo3)\n```\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld ~ inc + (inc|study), data = wm, REML = F)\nsummary(mofo3)\n```\n\n```{r}\nwm <- WhiteMoldSoybean\n\nwm |> \n  ggplot(aes(inc, yld)) +\n  geom_point() +\n  #facet_wrap(~ study) +\n  theme_minimal() +\n  geom_smooth(method = 'lm', se = T)\n```\n\n```{r}\nmofo1 <-  lm(yld ~ inc, data = wm)\nsummary(mofo1)\n```\n\n```{r}\nwm <- WhiteMoldSoybean\nwm |> \n  ggplot(aes(inc, yld))+\n  geom_point()+\n  facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\n#Predizer uma resposta em relação à outra. Duas respostas numéricas contínuas, ajustanto o modelo linear ou não. Muitos estudos diferentes, gráfico geral. A saída dos gráficos mostra que com a ação do fungicida e redução da severidade acontece um incremento de produtividade da soja.\n```\n\n```{r}\nmofo1 <-  lmer(yld ~ inc + (inc|study), data = wm, REML = F)\n\nsummary(mofo3)\n\n```\n\n```{r}\nconfint(mofo3, method = \"Wald\")\n```\n\n**Aula 10 - 29/05**\n\n# **Análise de correlação**\n\n## Pacotes carregados\n\n```{r}\n#pacotes \nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(AgroR)\nlibrary(corrplot)\n```\n\n## **Importando dados**\n\n```{r}\nimgs <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992\")\n```\n\nr2: coeficiente de determinação o quento da variação de y explicada pelo x;\n\nCoenficiente de correlação: a força de associação entre x e y;\n\nAnálise preeliminar dos dados.\n\n```{r}\nimgs1 <- imgs|> \n  ggplot(aes(Assess, LeafDoctor))+\ngeom_point()+ geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs2 <- imgs|> \n  ggplot(aes(Assess, ImageJ))+\ngeom_point()+geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs3 <- imgs |> \n  ggplot(aes(LeafDoctor, ImageJ))+\ngeom_point()+geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs1 + imgs2 + imgs3\n```\n\n## **Utilizando o AgroR**\n\n```{r}\n#matriz de correlação \nimgs2 <- imgs |> \n  dplyr::select(3:5)\n\n  corgraph(imgs2)\n  \n```\n\nMatriz de correlação Cor entrega o coeficiente de correlação de pearson. O cor test da uma estatística mais completa. O valor observado 0,98 é bem próximo de um, então indica uma correlação forte. Quanto maior a correlação menor o p-valor, se os dados forem mais dispersos o p-valor vai ser maior e não vai ser significativo. O corgraph é um pacote que indica a correlação entre as respostas da análise. Os valores dentro da matriz irão indicar o coeficiente de correlação entre as varíaveis observadas.\n\n```{r}\ncor.test(imgs$Assess, imgs$LeafDoctor)\n  cor(imgs$Assess, imgs$LeafDoctor)\n```\n\n```{r}\ncor_imgs2 <- cor(imgs2)\ncorrplot(cor_imgs2, method = \"number\", type = \"upper\")\n```\n\n## **Importando dados**\n\n```{r}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n```\n\n```{r}\ncampo2 <- campo |> \n  dplyr::select(DFC, FER, PROD)\n\ncorgraph(campo2)\n```\n\n```{r}\ncampo |> \n  ggplot(aes(DFC, PROD))+\n  geom_jitter()\n\n#O modelo quadratico é um experimento melhor do que o de primeira ordem, explica melhor o que vemos no gráfico anterior e a variação dos desvios. Pode ser utilizado essa variação, predizer o numero de plantas afetadas. y = (66,3 - 1,77trat) + (0,02trat^2) : equação do modelo\n```\n\n## **Importando dados**\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n```{r}\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_boxplot() +\n  facet_wrap(~ exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\")\n```\n\n```{r}\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_jitter(width = 0.1, alpha = 0.2) +\n  facet_wrap(~exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\") +\n  geom_smooth(method = \"lm\", se = F)\n```\n\n```{r}\nexp2 <- estande |>\n  filter (exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants)) +\n  geom_point() +\n  ylim(0,100) +\n  geom_smooth(method = \"lm\", se = F, formula = y ~poly(x,2), color = \"black\") +\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n```{r}\n#MODELO LINEAR\n\nexp2$trat2 <- exp2$trat^2\n\n#primeira ordem\nlm2 <- lm(nplants ~ trat, \n          data = exp2)\nsummary(lm2)\n```\n\n```{r}\nhist(residuals(lm2))\n```\n\n```{r}\n#segunda ordem\n\nlm3 <- lm(nplants ~ trat + trat2, \n          data = exp2)\nsummary(lm3)\n```\n\n```{r}\nhist(residuals(lm3))\n```\n\n```{r}\nAIC(lm2)\nAIC(lm3)\n```\n\n```{r}\nlibrary(AgroR)\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\n## **Importando dados**\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n```\n\n```{r}\npyra2 <- pyra |> \n  group_by(code, dose) |> \n  summarise(mean_germination = mean(germination))\n\npyra2 |> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  facet_wrap(~code)\n```\n\n```{r}\n\npyra2 <- pyra |>\n  group_by(code, dose) |>\n  summarise(mean_germination = mean(germination)) \n \nlibrary(drc)\n\nisolado186 <- pyra2 |>\n  filter(code == \"186\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado186,\n            fct = LL.3())\nAIC(drc1)\n```\n\n```{r}\nplot(drc1)\n```\n\n```{r}\nED(drc1, 50, interval = \"delta\")\n```\n\n```{r}\nsummary(drc1)\n```\n\n### **Usando o pacote ec50estimator**\n\nFaz tudo isso que foi feito anteriormente para todos os códigos.\n\n```{r}\nlibrary(ec50estimator)\n\n\ndf_ec50 <- estimate_EC50(mean_germination ~ dose, \n                         data = pyra2, \n                         isolate_col = \"code\",\n                         interval = \"delta\", \n                         fct = drc::LL.3())\n\n\n```\n\nGráfico com as doses de EC50 e intervalo de confiança:\n\n```{r}\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  geom_errorbar(aes(ymin = Lower,\n                    ymax = Upper),\n                width = 0.1)+\n  ylim (0, 1.2)+\n  coord_flip()\n```\n","srcMarkdownNoYaml":"\n\nDurante a aula 9, vão ser estudados dados que levam a entender melhor os Experimento fatorial e ajuste de modelos\n\n## Pacotes carregados\n\n```{r}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(performance)\nlibrary(DHARMa)\nlibrary(emmeans)\nlibrary(multcomp)\nlibrary(r4pde)\nlibrary(drc)\nlibrary(stats)\n```\n\n## **Importando dados**\n\n```{r}\nmilho <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=1345524759\")\n```\n\n## **Análise de um experimento em parcelas subdivididas**\n\nExperimentos em parcelas subdivididas são utilizados quando o nível de um fator primário (ou tratamento) é aplicado a uma parcela relativamente grande e todos os níveis de um segundo fator secundário são aplicados às subparcelas desta parcela maior. Os tratamentos primários são distribuídos às parcelas de acordo com um delineamento especificado, já os tratamentos secundários são distribuídos às subparcelas de forma aleatória.\n\n## **visualização dos dados**\n\n```{r}\nmilho |> \n  ggplot(aes(method,index))+\n  geom_jitter(which = 0.1, alpha = 0.2)+\n  facet_wrap(~ hybrid)+\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"blue\")\n\n##Dependendo do híbrido parece que há efeito do método\n\n```\n\n## **Modelo para parcela subdividida**\n\n```{r}\nmilho <- milho |> \n  mutate(block = as.factor(block))\n\nmix2 <- lmer(index ~ hybrid*method + block + (1|block/hybrid),\n            data = milho)\n\n\n#No fator aleatório, colocamos o hibrido dentro do bloco. ( 1 | block/hybrid); Comparamos os híbridos nas linhas e os métodos nas colunas.\n\n```\n\nANOVA MIX2\n\n```{r}\nanova (mix2)\n```\n\n#### **Verificação das premissas**\n\n```{r}\ncheck_normality(mix2)\ncheck_heteroscedasticity(mix2)\n```\n\n```{r}\nplot(simulateResiduals(mix2))\nqqnorm(residuals(mix2))\nqqline(residuals(mix2))\nhist(residuals(mix2))\n\n```\n\nConclui-se que os dados seguem distribuição normal. Porém, não há homogeneidade de variância entre os grupos. Logo será preciso uma alternativa para prosseguir a análise, por exemplo a transformação dos dados com raiz quadrada.\n\nDepois de carregar o Emmeans:\n\n```{r}\nmedias_milho <- emmeans(mix2,\n                        ~ hybrid | method,\n                        type = \"response\")\nmedias_milho\nmedias_milho2 <- emmeans(mix2,\n                         ~ method | hybrid,\n                         type = \"response\")\nmedias_milho2\n```\n\n```{r}\ncld(medias_milho2, Letters = LETTERS)\n```\n\nA significância da anova ou efeitos da interação; Realiza-se o teste de médias se há efeito; Comparamos a diferença dentro dos métodos, e depois, comparamos a diferença entre os métodos dentro dos híbridos.\n\n## **Produtividade (yield)**\n\nSeguindo os mesmos procedimentos para o índice de doença, será conduzida avaliação da produtividade.\n\n```{r}\nmix3 <- lmer(sqrt(index) ~ hybrid*method + block + (1|block/hybrid), data = milho)\n```\n\n**ANOVA MIX3**\n\n```{r}\nanova (mix3)\n```\n\n#### **Verificação das premissas**\n\n```{r}\ncheck_normality(mix3)\ncheck_heteroscedasticity(mix3)\n\n```\n\n# **Regressão linear**\n\nUsada para modelar e analisar a relação entre uma variável dependente (também chamada de variável resposta) e uma ou mais variáveis independentes (também chamadas de variáveis preditoras). O objetivo da regressão linear é ajustar uma linha reta (ou um plano, no caso de múltiplas variáveis) aos dados que minimiza a soma dos quadrados dos resíduos (a diferença entre os valores observados e os valores previstos pelo modelo).\n\n## **Importando dados**\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n## **visualização dos dados**\n\n```{r}\n   estande |> \n  ggplot(aes(trat, nplants))+\n  geom_jitter(which = 0.1, alpha = 0.3)+\n  facet_wrap(~ exp)+\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5, color = \"black\")+\n     geom_smooth(method = \"lm\", se = F)\n\n   \n   #Mostramos biologicamente que há redução do estande de plantas conforme o aumento da inoculação do patógeno. podemos assumir dois modelos: linear simples ou quadrático. Podemos verificar qual modelo se adequa melhor à regressão.\n```\n\nExperimento 1:\n\n```{r}\nexp1 <- estande |> \n  filter(exp == 1)\n\nexp1 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F)\n```\n\n```{r}\n#MODELO LINEAR\n\nlm1 = lm(nplants ~ trat,\n         data = exp1)\n\nsummary (lm1)\n```\n\nExperimento 2:\n\n```{r}\nexp2 <- estande |> \n  filter(exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F, method = \"lm\",\n              formula = y~poly(x,2),\n              color = \"red\")+\n  geom_smooth(method = \"lm\", se = FALSE)\n\n\n```\n\n```{r}\n\n#Modelo de primeira ordem\nlm2 <- lm(nplants~trat,\n          data = exp2)\n\nsummary(lm2)\nhist(residuals(lm2))\n\n# Nodelo de segunda ordem\nexp2$trat2 <- exp2$trat^2\n\n```\n\nExperimento 3:\n\n```{r}\nexp3 <- estande |> \n  filter(exp == 3)\n\nexp3 |> \n  ggplot(aes(trat, nplants))+\n  geom_point()+\n  geom_smooth(se = F) #method = \"lm\")\n```\n\n```{r}\nlm3 <- lm(nplants~trat + trat2,\n          data = exp2)\n\nsummary(lm3)\nhist(residuals(lm3))\n```\n\nComparação de modelos diferente usando os mesmos dados\n\n### **Usando GLM**\n\nPodemos atribuir o glm com distribuição normal ou distribuição de poisson (considerando que a distribuição não é normal).\n\n```{r}\n#glm2 <- glm(nplants ~ trat, family = gaussian, data = exp2)\n#summary(glm2)\n\n#AIC(glm2)\n\nglm2b <- glm(nplants ~ trat, family = \"poisson\", data  = exp2)\nsummary(glm2b)\n```\n\n```{r}\nglm2b <- glm(nplants ~ trat, family = poisson(link = \"log\"),\n             data = exp2)\nsummary(glm2b)\nAIC(glm2b)\n```\n\n## **Análise de múltiplos ensaios**\n\nCom múltiplos ensaios, é possível analisá-los individualmente para observar uma tendência geral no comportamento dos tratamentos. No entanto, existem outras alternativas, como aplicar um modelo de regressão linear global ou extrair a informação global utilizando modelos mistos. Nesse caso, os ensaios são tratados como fator aleatório, ou seja, advêm de uma distribuição (população), e o objetivo é estimar os parâmetros para essa população. Para exemplificar esse caso, um conjunto de dados (`WhiteMoldSoybean`) presente no pacote **`r4pde`** será importado, mas antes o pacote deverá ser carregado. AIC menor é o melhor modelo ajustado.\n\n```{r}\nwm <- WhiteMoldSoybean\n\n\nwm |> \n  ggplot(aes(inc, yld))+\n  geom_point()+\n  facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\n#Predizer uma resposta em relação à outra. Duas respostas numéricas contínuas, ajustanto o modelo linear ou não. Muitos estudos diferentes, gráfico geral. A saída dos gráficos mostra que com a ação do fungicida e redução da severidade acontece um incremento de produtividade da soja.\n```\n\n```{r}\nmofo1 <- lm(yld ~ inc,\n            data = wm)\n#intercepto pordutividade quando a incidencia é zero, inc é o slope com 10% de incidencia esta perdendo 90kg. \nsummary(mofo1)\n\n#O 3299 é a produtividade por ha quando não há controle. O 9,261 indica a redução de produtividade em kg/ha de acordo com o aumento da severidade.\n```\n\n### **Modelo linear por ensaio**\n\nAgrupando todos os estudos em um único gráfico.\n\n#### **Mofo 1**\n\n```{r}\nwm |> \n  ggplot(aes(inc, yld, group = factor(study)))+\n  geom_point()+\n  #facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\nmofo1 <- lm(yld ~ inc,\n            data = wm)\nsummary(mofo1)\n\n#Código muito importante para agrupar vários experimentos. Já detalha as médias para cada variável resposta.\n```\n\n#### **Mofo 2**\n\n```{r}\nlibrary(broom)\nmofo2 <- wm |> \n  group_by(study) |> \n  do(tidy(lm(.$yld ~ .$inc), conf.int = TRUE))\nmofo2\n```\n\n```{r}\ndf<- mofo2 |> \n  filter(term == \".$inc\")\nmean(df$estimate)\n```\n\n```{r}\n#Histograma da produtividade quando incidência é 0\nlibrary(cowplot)\np1 <- mofo2 |> \n  filter(term == \"(Intercept)\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Intercept\", y = \"frequency\")\np2 <- mofo2 |> \n  filter(term == \".$inc\") |> \n           ggplot(aes(x = estimate))+\n           geom_histogram(bins = 8, color = \"white\", fill = \"gray\")+\n           theme_r4pde()+\n           labs(x = \"Slopes\", y = \"frequency\")\nlibrary(patchwork)\np1+p2\n\n\n```\n\n**Mofo 3**\n\n**Modelo misto**\n\n```{r}\n#Modelo misto\nmofo3 <- lmer(yld ~ inc + (inc | study), data = wm,\n              REML = F)\nsummary(mofo3)\n```\n\n```{r}\nlibrary(lme4)\nmofo3 <- lmer(yld ~ inc + (inc|study), data = wm, REML = F)\nsummary(mofo3)\n```\n\n```{r}\nwm <- WhiteMoldSoybean\n\nwm |> \n  ggplot(aes(inc, yld)) +\n  geom_point() +\n  #facet_wrap(~ study) +\n  theme_minimal() +\n  geom_smooth(method = 'lm', se = T)\n```\n\n```{r}\nmofo1 <-  lm(yld ~ inc, data = wm)\nsummary(mofo1)\n```\n\n```{r}\nwm <- WhiteMoldSoybean\nwm |> \n  ggplot(aes(inc, yld))+\n  geom_point()+\n  facet_wrap(~ study)+\n  theme_minimal()+\n  geom_smooth(method = \"lm\", se = F)\n\n#Predizer uma resposta em relação à outra. Duas respostas numéricas contínuas, ajustanto o modelo linear ou não. Muitos estudos diferentes, gráfico geral. A saída dos gráficos mostra que com a ação do fungicida e redução da severidade acontece um incremento de produtividade da soja.\n```\n\n```{r}\nmofo1 <-  lmer(yld ~ inc + (inc|study), data = wm, REML = F)\n\nsummary(mofo3)\n\n```\n\n```{r}\nconfint(mofo3, method = \"Wald\")\n```\n\n**Aula 10 - 29/05**\n\n# **Análise de correlação**\n\n## Pacotes carregados\n\n```{r}\n#pacotes \nlibrary(tidyverse)\nlibrary(patchwork)\nlibrary(AgroR)\nlibrary(corrplot)\n```\n\n## **Importando dados**\n\n```{r}\nimgs <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=373270992\")\n```\n\nr2: coeficiente de determinação o quento da variação de y explicada pelo x;\n\nCoenficiente de correlação: a força de associação entre x e y;\n\nAnálise preeliminar dos dados.\n\n```{r}\nimgs1 <- imgs|> \n  ggplot(aes(Assess, LeafDoctor))+\ngeom_point()+ geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs2 <- imgs|> \n  ggplot(aes(Assess, ImageJ))+\ngeom_point()+geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs3 <- imgs |> \n  ggplot(aes(LeafDoctor, ImageJ))+\ngeom_point()+geom_smooth(method = \"lm\")\n```\n\n```{r}\nimgs1 + imgs2 + imgs3\n```\n\n## **Utilizando o AgroR**\n\n```{r}\n#matriz de correlação \nimgs2 <- imgs |> \n  dplyr::select(3:5)\n\n  corgraph(imgs2)\n  \n```\n\nMatriz de correlação Cor entrega o coeficiente de correlação de pearson. O cor test da uma estatística mais completa. O valor observado 0,98 é bem próximo de um, então indica uma correlação forte. Quanto maior a correlação menor o p-valor, se os dados forem mais dispersos o p-valor vai ser maior e não vai ser significativo. O corgraph é um pacote que indica a correlação entre as respostas da análise. Os valores dentro da matriz irão indicar o coeficiente de correlação entre as varíaveis observadas.\n\n```{r}\ncor.test(imgs$Assess, imgs$LeafDoctor)\n  cor(imgs$Assess, imgs$LeafDoctor)\n```\n\n```{r}\ncor_imgs2 <- cor(imgs2)\ncorrplot(cor_imgs2, method = \"number\", type = \"upper\")\n```\n\n## **Importando dados**\n\n```{r}\ncampo <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=866852711\")\n```\n\n```{r}\ncampo2 <- campo |> \n  dplyr::select(DFC, FER, PROD)\n\ncorgraph(campo2)\n```\n\n```{r}\ncampo |> \n  ggplot(aes(DFC, PROD))+\n  geom_jitter()\n\n#O modelo quadratico é um experimento melhor do que o de primeira ordem, explica melhor o que vemos no gráfico anterior e a variação dos desvios. Pode ser utilizado essa variação, predizer o numero de plantas afetadas. y = (66,3 - 1,77trat) + (0,02trat^2) : equação do modelo\n```\n\n## **Importando dados**\n\n```{r}\nestande <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=401662555\")\n```\n\n```{r}\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_boxplot() +\n  facet_wrap(~ exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\")\n```\n\n```{r}\nestande |>\n  ggplot(aes(trat, nplants, color = factor (exp))) +\n  geom_jitter(width = 0.1, alpha = 0.2) +\n  facet_wrap(~exp) +\n  theme_bw() +\n  stat_summary(fun.data = \"mean_cl_boot\", size = 0.5,\n               color = \"black\") +\n  geom_smooth(method = \"lm\", se = F)\n```\n\n```{r}\nexp2 <- estande |>\n  filter (exp == 2)\n\nexp2 |> \n  ggplot(aes(trat, nplants)) +\n  geom_point() +\n  ylim(0,100) +\n  geom_smooth(method = \"lm\", se = F, formula = y ~poly(x,2), color = \"black\") +\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n```\n\n```{r}\n#MODELO LINEAR\n\nexp2$trat2 <- exp2$trat^2\n\n#primeira ordem\nlm2 <- lm(nplants ~ trat, \n          data = exp2)\nsummary(lm2)\n```\n\n```{r}\nhist(residuals(lm2))\n```\n\n```{r}\n#segunda ordem\n\nlm3 <- lm(nplants ~ trat + trat2, \n          data = exp2)\nsummary(lm3)\n```\n\n```{r}\nhist(residuals(lm3))\n```\n\n```{r}\nAIC(lm2)\nAIC(lm3)\n```\n\n```{r}\nlibrary(AgroR)\nwith(exp2, polynomial(trat, nplants, grau = 3))\n```\n\n## **Importando dados**\n\n```{r}\npyra <- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1bq2N19DcZdtax2fQW9OHSGMR0X2__Z9T/edit#gid=465348652\")\n```\n\n```{r}\npyra2 <- pyra |> \n  group_by(code, dose) |> \n  summarise(mean_germination = mean(germination))\n\npyra2 |> \n  ggplot(aes(dose, mean_germination))+\n  geom_point()+\n  facet_wrap(~code)\n```\n\n```{r}\n\npyra2 <- pyra |>\n  group_by(code, dose) |>\n  summarise(mean_germination = mean(germination)) \n \nlibrary(drc)\n\nisolado186 <- pyra2 |>\n  filter(code == \"186\")\n\ndrc1 <- drm(mean_germination ~ dose, data = isolado186,\n            fct = LL.3())\nAIC(drc1)\n```\n\n```{r}\nplot(drc1)\n```\n\n```{r}\nED(drc1, 50, interval = \"delta\")\n```\n\n```{r}\nsummary(drc1)\n```\n\n### **Usando o pacote ec50estimator**\n\nFaz tudo isso que foi feito anteriormente para todos os códigos.\n\n```{r}\nlibrary(ec50estimator)\n\n\ndf_ec50 <- estimate_EC50(mean_germination ~ dose, \n                         data = pyra2, \n                         isolate_col = \"code\",\n                         interval = \"delta\", \n                         fct = drc::LL.3())\n\n\n```\n\nGráfico com as doses de EC50 e intervalo de confiança:\n\n```{r}\ndf_ec50 |> \n  ggplot(aes(reorder(ID, Estimate), Estimate))+\n  geom_point()+\n  geom_errorbar(aes(ymin = Lower,\n                    ymax = Upper),\n                width = 0.1)+\n  ylim (0, 1.2)+\n  coord_flip()\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Aula9e10.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","editor":"visual","theme":{"light":"flatly","dark":"superhero"},"title":"Experimento fatorial e ajuste de modelos - Análise de correlação","message":false},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}